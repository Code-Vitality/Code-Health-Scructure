#!/bin/bash

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ gdfmt
if ! command -v gdscriptfmt &> /dev/null
then
    echo "‚ùå gdfmt –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ gdfmt."
    exit 1
fi

# –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî —Ç–µ–∫—É—â–∞—è
DIRECTORY="."

# –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω –ø—É—Ç—å, —Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –∫–∞–∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
if [ $# -gt 0 ]; then
    DIRECTORY="$1"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∫–∞–∑–∞–Ω–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
if [ ! -d "$DIRECTORY" ]; then
    echo "‚ùå –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è $DIRECTORY –Ω–µ –Ω–∞–π–¥–µ–Ω–∞."
    exit 1
fi

echo "üöÄ –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã GDScript –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ $DIRECTORY..."

# –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö .gd —Ñ–∞–π–ª–æ–≤
find "$DIRECTORY" -type f -name "*.gd" -exec gdscriptfmt {} \;

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
if [ $? -eq 0 ]; then
    echo "‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã GDScript —É—Å–ø–µ—à–Ω–æ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω—ã!"
else
    echo "‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤."
    exit 1
fi
